<!doctype html>
<html lang="vi">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Đăng Ký - Hệ Thống Quản Lý Bệnh Viện</title>
    <link rel="stylesheet" href="style.css?v=3.1" />
  </head>
  <body>
    <div class="auth-page">
      <div class="auth-container">
        <div class="auth-header">
          <div class="auth-logo">🏥</div>
          <h1>Đăng Ký Tài Khoản</h1>
          <p>Tạo tài khoản mới để sử dụng hệ thống</p>
        </div>

        <form id="registerForm" class="auth-form">
          <div class="form-group">
            <label for="regUsername">👤 Tên Đăng Nhập</label>
            <input 
              id="regUsername" 
              type="text"
              placeholder="Nhập tên đăng nhập" 
              required 
              autocomplete="username"
              minlength="3"
            />
            <small class="form-hint">Tối thiểu 3 ký tự</small>
          </div>

          <div class="form-group">
            <label for="regPassword">🔒 Mật Khẩu</label>
            <input 
              id="regPassword" 
              type="password"
              placeholder="Nhập mật khẩu" 
              required 
              autocomplete="new-password"
              minlength="6"
            />
            <small class="form-hint">Tối thiểu 6 ký tự</small>
          </div>

          <div class="form-group">
            <label for="regPasswordConfirm">🔒 Nhập Lại Mật Khẩu</label>
            <input 
              id="regPasswordConfirm" 
              type="password"
              placeholder="Nhập lại mật khẩu" 
              required 
              autocomplete="new-password"
            />
            <small class="form-hint">Phải trùng với mật khẩu ở trên</small>
          </div>

          <div class="form-options">
            <label class="checkbox-label">
              <input type="checkbox" id="agreeTerms" required />
              <span>Tôi đồng ý với <a href="#" class="link-primary">Điều khoản sử dụng</a></span>
            </label>
          </div>

          <button type="submit" class="btn-auth success">
            📝 Đăng Ký
          </button>

          <div id="authResult" class="result-message"></div>
        </form>

        <div class="auth-footer">
          <p>Đã có tài khoản? <a href="login.html" class="link-primary">Đăng nhập ngay</a></p>
          <a href="index.html" class="link-secondary">← Quay lại Trang chủ</a>
        </div>
      </div>

      <div class="auth-illustration">
        <div class="illustration-content">
          <h2>🌟 Tham Gia Cùng Chúng Tôi</h2>
          <p>🎯 Giao diện thân thiện, dễ sử dụng</p>
          <p>🎯 Bảo mật cao với công nghệ hiện đại</p>
          <p>🎯 Quản lý thông tin nhanh chóng</p>
          <p>🎯 Hỗ trợ tận tâm 24/7</p>
        </div>
      </div>
    </div>

    <script type="module">
      import { registerUser } from './api.js';

      document.getElementById('registerForm').addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const username = document.getElementById('regUsername').value;
        const password = document.getElementById('regPassword').value;
        const passwordConfirm = document.getElementById('regPasswordConfirm').value;
        const resultDiv = document.getElementById('authResult');
        
        // Kiểm tra mật khẩu khớp
        if (password !== passwordConfirm) {
          resultDiv.textContent = '❌ Mật khẩu không khớp! Vui lòng nhập lại.';
          resultDiv.className = 'result-message error-message';
          return;
        }

        // Kiểm tra độ dài mật khẩu
        if (password.length < 6) {
          resultDiv.textContent = '❌ Mật khẩu phải có tối thiểu 6 ký tự!';
          resultDiv.className = 'result-message error-message';
          return;
        }

        // Kiểm tra độ dài username
        if (username.length < 3) {
          resultDiv.textContent = '❌ Tên đăng nhập phải có tối thiểu 3 ký tự!';
          resultDiv.className = 'result-message error-message';
          return;
        }
        
        resultDiv.textContent = 'Đang đăng ký...';
        resultDiv.className = 'result-message info-message';
        
        try {
          const data = await registerUser(username, password);
          
          if (data.message || !data.error) {
            resultDiv.textContent = '✅ Đăng ký thành công! Đang chuyển đến trang đăng nhập...';
            resultDiv.className = 'result-message success-message';
            
            setTimeout(() => {
              window.location.href = 'login.html';
            }, 1500);
          } else {
            resultDiv.textContent = '❌ Đăng ký thất bại: ' + (data.error || 'Tên đăng nhập đã tồn tại');
            resultDiv.className = 'result-message error-message';
          }
        } catch (error) {
          resultDiv.textContent = '❌ Lỗi: ' + (error.message || 'Không thể kết nối đến máy chủ');
          resultDiv.className = 'result-message error-message';
        }
      });

      // Hiển thị cảnh báo khi mật khẩu không khớp
      document.getElementById('regPasswordConfirm').addEventListener('input', function() {
        const password = document.getElementById('regPassword').value;
        const passwordConfirm = this.value;
        
        if (passwordConfirm && password !== passwordConfirm) {
          this.style.borderColor = 'var(--danger)';
        } else {
          this.style.borderColor = '';
        }
      });
    </script>
  </body>
</html>
